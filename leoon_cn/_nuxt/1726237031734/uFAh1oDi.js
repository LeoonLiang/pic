import{_ as k,E as $,a as I}from"./D0ZUU1KL.js";import{u as x,e as C}from"./DZ4bjJ-W.js";import{q as _,ad as S,v as n,x as r,y as p,T as h,U as m,J as y,ac as L,I as u,ai as E,al as B,r as w,k as N,P as f,j as g,Q as V}from"./CGHQ5HZD.js";const P=(e,t)=>{const o=`https://cdn.tsinbei.com/gh/LeoonLiang/pic@main/tuchong/image-${e}.${t?"avif":"jpg"}`;return new Promise((a,s)=>{const c=new Image;c.src=o,c.onload=()=>{a(o)},c.onerror=l=>[s(l)]})},q=_({name:"PictureCard",props:{imageList:{type:Array,default:""},title:{type:String,default:""},desc:{type:String,default:""},favorites:{type:Number,default:0}},data(){return{viewer:null,originList:[],curIndex:0,showViewer:!1}},methods:{handlePopstate(e){var t;this.showViewer&&((t=this.viewer)==null||t.hide())},handleImg(e){this.viewer=this.$viewerApi({options:{toolbar:!1,initialViewIndex:e,title:!1,show:()=>{history.pushState({popup:!0},""),window.addEventListener("popstate",this.handlePopstate),this.showViewer=!0},hide:()=>{this.showViewer=!1,history.state&&history.state.popup&&history.back(),window.removeEventListener("popstate",this.handlePopstate)},viewed:t=>{if(this.curIndex=t.detail.index,this.originList[this.curIndex]){t.detail.image.src=this.originList[this.curIndex];return}document.querySelector(".viewer-canvas").classList.add("viewer-loading"),P(this.imageList[this.curIndex].img_id.toString(),this.$supportsAvif.value).then(i=>{this.originList[this.curIndex]=i,this.curIndex===t.detail.index&&(this.viewer.image.src=this.originList[this.curIndex])}).catch(()=>{console.log("没有原图")}).finally(()=>{this.curIndex===t.detail.index&&document.querySelector(".viewer-canvas").classList.remove("viewer-loading")})},ready:t=>{const i=document.querySelector(".viewer-container"),o=document.createElement("div");o.className="viewer-prev-custom",o.innerHTML='<i class="iconfont icon-prev1" />',o.onclick=()=>{this.viewer.prev()};const a=document.createElement("div");a.className="viewer-next-custom",a.innerHTML='<i class="iconfont icon-prev1" />',a.onclick=()=>{this.viewer.next()};const s=document.createElement("div");s.className="viewer-close-custom",s.innerHTML='<i class="iconfont icon-close" />',s.onclick=()=>{this.viewer.hide()},i==null||i.appendChild(o),i==null||i.appendChild(a),i==null||i.appendChild(s)}},images:this.imageList.map(t=>t.lr)})}}}),T={class:"leoon-picture-wall"},b={class:"leoon-picture-wall-info"},M={key:0,class:"leoon-picture-wall-title"},H={key:1,class:"leoon-picture-wall-excerpt"},A={key:2,class:"leoon-picture-wall-addition"},j={class:"leoon-picture-wall-img"},D={class:"leoon-picture-wall-img-wrapper"},J={key:0,class:"leoon-picture-wall-img-wrapper nine"};function F(e,t,i,o,a,s){const c=k;return n(),r("div",T,[p("div",b,[e.title?(n(),r("div",M,h(e.title),1)):m("",!0),e.desc?(n(),r("div",H,h(e.desc),1)):m("",!0),e.favorites?(n(),r("div",A," 喜欢 "+h(e.favorites),1)):m("",!0)]),p("div",j,[(n(!0),r(y,null,L(e.imageList.slice(0,8),(l,v)=>(n(),r("div",D,[u(c,{onClick:d=>e.handleImg(v),src:l.lr,ratio:"1",fit:"cover"},null,8,["onClick","src"])]))),256)),e.imageList.length>8?(n(),r("div",J,[u(c,{src:e.imageList[8].lr,ratio:"1",fit:"cover"},null,8,["src"]),p("div",{onClick:t[0]||(t[0]=l=>e.handleImg(8)),class:"img-number-mask"}," +"+h(e.imageList.length-8),1)])):m("",!0)])])}const O=S(q,[["render",F]]),Q={class:"post-wrapper",style:{width:"1086px"}},R={class:"leoon-picture-wall"},U={class:"leoon-picture-wall-info"},W={class:"leoon-picture-wall-img"},X=_({__name:"index",setup(e){const t=E();B({title:"摄影 - Leoon Liang - Blog",ogTitle:"摄影 - Leoon Liang - Blog"});const i=w([]),o=w(!0),a=async()=>{try{const{data:s}=await $fetch("/api/tc",{params:t.query,headers:{...x(t.query)}});s&&(i.value=JSON.parse(C(s)).post_list)}catch{}finally{o.value=!1}};return N(()=>{a()}),(s,c)=>{const l=I,v=$;return n(),r("div",Q,[u(v,{loading:g(o)&&g(i).length===0,animated:"",count:3,throttle:60},{template:f(()=>[p("div",R,[p("div",U,[u(l,{variant:"h1",class:"leoon-picture-wall-title",style:{width:"70%"}}),u(l,{variant:"h3",class:"leoon-picture-wall-excerpt",style:{width:"50%"}}),u(l,{variant:"text",class:"leoon-picture-wall-addition",style:{width:"20%"}})]),p("div",W,[u(l,{variant:"image",style:{width:"100%"}})])])]),default:f(()=>[(n(!0),r(y,null,L(g(i),d=>(n(),V(O,{key:d.post_id,"image-list":d.images,title:d.title,desc:d.excerpt,favorites:d.favorites,styles:d.styles},null,8,["image-list","title","desc","favorites","styles"]))),128))]),_:1},8,["loading"])])}}});export{X as default};
