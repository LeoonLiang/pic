import{E as N,a as S}from"./CkiXlDQg.js";import{A as B,_ as x}from"./ClVWZ7MK.js";import{u as E,a as U}from"./BBsC0ZjE.js";import{l as A,aq as M,r as d,z as V,D as q,o as C,n as l,p as i,Z as f,e as r,a0 as H,q as w,u as I,v as c,L as j,U as D,ai as F}from"./BgPjTGvo.js";import"./DRgdK3DU.js";import"./E08Yss0p.js";import"./DtVQwedt.js";const P={class:"moment-wrapper",style:{width:"1086px"}},T={class:"article-item-wrapper"},$={class:"article-item-wrapper"},z={key:0,class:"list-loading"},J={key:1,class:"list-loading"},X=A({__name:"moment",setup(O){M({title:"随笔 - Leoon Liang - Blog",ogTitle:"随笔 - Leoon Liang - Blog"});const a=d([]),u=d(!1),o=d(!0),n=d({labels:"",per_page:10,page:1}),g=async()=>{const e=I();try{if(o.value||u.value)return;o.value=!0;const t={labels:n.value.labels,per_page:n.value.per_page.toString(),page:n.value.page.toString()},{data:s}=await $fetch("/api/moment",{params:t,headers:{...E(t),"x-fingerprint":e.$fingerprint.value}});if(s){const p=JSON.parse(U(s));a.value=[...a.value,...p],p.length<n.value.per_page?u.value=!0:n.value.page=n.value.page+1}o.value=!1}catch{o.value=!1}},L=e=>(e=e.replace(/https:\/\/raw\.githubusercontent\.com\/LeoonLiang\/pic\/main\//g,"https://gcore.jsdelivr.net/gh/LeoonLiang/pic@main/"),e.replace(/\/\/(?:\w+\.)?jsdelivr\.net/g,"//cdn.tsinbei.com")),v=()=>{const e=window.scrollY+window.innerHeight,t=document.body.scrollHeight-100;e>=t&&g()},k=(e,t)=>{a.value.splice(e,1,t)},y=(e,t)=>{a.value[e].is_like=t,a.value[e].like_count=t?Number(a.value[e].like_count)+1:Number(a.value[e].like_count)-1};return V(()=>{u.value||window.addEventListener("scroll",v)}),q(()=>{window.removeEventListener("scroll",v)}),C(()=>{n.value.page=1,a.value=[],o.value=!1,g()}),(e,t)=>{const s=S,p=N,b=x;return c(),l("div",P,[i(p,{loading:r(o)&&r(a).length===0,animated:"",count:6,throttle:60},{template:f(()=>[j("div",T,[i(s,{variant:"h1",style:{width:"40%",display:"block"}}),i(s,{variant:"text",style:{width:"20%","margin-top":"0.5rem"}})])]),default:f(()=>[(c(!0),l(D,null,F(r(a),(m,h)=>(c(),l("div",$,[i(B,{body:L(m.body),"update-time":m.created_at,issue:m,"is-list":"",onUpdate:_=>k(h,_),onLike:_=>y(h,_)},null,8,["body","update-time","issue","onUpdate","onLike"])]))),256))]),_:1},8,["loading"]),r(o)?(c(),l("div",z,[i(b),H("疯狂加载中...")])):w("",!0),r(u)?(c(),l("div",J,"没有更多内容了")):w("",!0)])}}});export{X as default};
