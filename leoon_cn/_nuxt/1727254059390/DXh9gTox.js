import{E as N,a as S}from"./P69oAG0X.js";import{A as x,_ as B}from"./DGLBy15x.js";import{u as E,a as A}from"./BrZE1g2q.js";import{l as U,aq as M,r as d,A as V,E as q,o as C,n as l,q as i,Z as f,e as r,a0 as H,v as w,u as I,x as c,p as j,U as F,ai as P}from"./CO20ueEb.js";import"./DZCde2b0.js";import"./DAw-qo3Y.js";import"./BoCYI9ys.js";const T={class:"moment-wrapper",style:{width:"1086px"}},$={class:"article-item-wrapper"},D={class:"article-item-wrapper"},J={key:0,class:"list-loading"},O={key:1,class:"list-loading"},X=U({__name:"moment",setup(Y){M({title:"随笔 - Leoon Liang - Blog",ogTitle:"随笔 - Leoon Liang - Blog"});const a=d([]),u=d(!1),o=d(!0),n=d({labels:"",per_page:10,page:1}),g=async()=>{const e=I();try{if(o.value||u.value)return;o.value=!0;const t={labels:n.value.labels,per_page:n.value.per_page.toString(),page:n.value.page.toString()},{data:s}=await $fetch("/api/moment",{params:t,headers:{...E(t),"x-fingerprint":e.$fingerprint.value}});if(s){const p=JSON.parse(A(s));a.value=[...a.value,...p],p.length<n.value.per_page?u.value=!0:n.value.page=n.value.page+1}o.value=!1}catch{o.value=!1}},k=e=>(e=e.replace(/https:\/\/raw\.githubusercontent\.com\/LeoonLiang\/pic\/main\//g,"https://gcore.jsdelivr.net/gh/LeoonLiang/pic@main/"),e.replace(/\/\/(?:\w+\.)?jsdelivr\.net/g,"//cdn.tsinbei.com")),v=()=>{const e=window.scrollY+window.innerHeight,t=document.body.scrollHeight-100;e>=t&&g()},L=(e,t)=>{a.value.splice(e,1,t)},y=(e,t)=>{a.value[e].is_like=t,a.value[e].like_count=t?Number(a.value[e].like_count)+1:Number(a.value[e].like_count)-1};return V(()=>{u.value||window.addEventListener("scroll",v)}),q(()=>{window.removeEventListener("scroll",v)}),C(()=>{n.value.page=1,a.value=[],o.value=!1,g()}),(e,t)=>{const s=S,p=N,b=B;return c(),l("div",T,[i(p,{loading:r(o)&&r(a).length===0,animated:"",count:6,throttle:60},{template:f(()=>[j("div",$,[i(s,{variant:"h1",style:{width:"40%",display:"block"}}),i(s,{variant:"text",style:{width:"20%","margin-top":"0.5rem"}})])]),default:f(()=>[(c(!0),l(F,null,P(r(a),(m,h)=>(c(),l("div",D,[i(x,{body:k(m.body),"update-time":m.created_at,issue:m,"is-list":"",onUpdate:_=>L(h,_),onLike:_=>y(h,_)},null,8,["body","update-time","issue","onUpdate","onLike"])]))),256))]),_:1},8,["loading"]),r(o)?(c(),l("div",J,[i(b),H("疯狂加载中...")])):w("",!0),r(u)?(c(),l("div",O,"没有更多内容了")):w("",!0)])}}});export{X as default};
