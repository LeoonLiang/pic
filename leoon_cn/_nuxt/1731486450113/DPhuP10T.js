import{E as N,a as S}from"./zmv96neU.js";import{A as B,_ as x}from"./BUY5v7dD.js";import"./CXoJfuOd.js";import{d as E,u as M,r as d,i as U,l as A,y as V,c as l,e as i,R as f,a as r,U as C,f as w,ad as H,o as c,b as I,M as j,ab as F}from"./B4rtTu_i.js";import{u as P,a as T}from"./dc5OHkd4.js";import"./QG9UAsuk.js";import"./BrpRIDbu.js";import"./s8d2RB4u.js";const $={class:"moment-wrapper",style:{width:"1086px"}},q={class:"article-item-wrapper"},D={class:"article-item-wrapper"},J={key:0,class:"list-loading"},O={key:1,class:"list-loading"},ee=E({__name:"moment",setup(R){M({title:"随笔 - Leoon Liang - Blog",ogTitle:"随笔 - Leoon Liang - Blog"});const a=d([]),u=d(!1),o=d(!0),n=d({labels:"",per_page:30,page:1}),g=async()=>{const e=H();try{if(o.value||u.value)return;o.value=!0;const t={labels:n.value.labels,per_page:n.value.per_page.toString(),page:n.value.page.toString()},{data:s}=await $fetch("/api/moment",{params:t,headers:{...P(t),"x-fingerprint":e.$fingerprint.value}});if(s){const p=JSON.parse(T(s));a.value=[...a.value,...p],p.length<n.value.per_page?u.value=!0:n.value.page=n.value.page+1}o.value=!1}catch{o.value=!1}},k=e=>(e=e.replace(/https:\/\/raw\.githubusercontent\.com\/LeoonLiang\/pic\/main\//g,"https://gcore.jsdelivr.net/gh/LeoonLiang/pic@main/"),e.replace(/\/\/(?:\w+\.)?jsdelivr\.net/g,"//cdn.tsinbei.com")),v=()=>{const e=window.scrollY+window.innerHeight,t=document.body.scrollHeight-100;e>=t&&g()},L=(e,t)=>{a.value.splice(e,1,t)},b=(e,t)=>{a.value[e].is_like=t,a.value[e].like_count=t?Number(a.value[e].like_count)+1:Number(a.value[e].like_count)-1};return U(()=>{u.value||window.addEventListener("scroll",v)}),A(()=>{window.removeEventListener("scroll",v)}),V(()=>{n.value.page=1,a.value=[],o.value=!1,g()}),(e,t)=>{const s=S,p=N,y=x;return c(),l("div",$,[i(p,{loading:r(o)&&r(a).length===0,animated:"",count:6,throttle:60},{template:f(()=>[I("div",q,[i(s,{variant:"h1",style:{width:"40%",display:"block"}}),i(s,{variant:"text",style:{width:"20%","margin-top":"0.5rem"}})])]),default:f(()=>[(c(!0),l(j,null,F(r(a),(m,h)=>(c(),l("div",D,[i(B,{body:k(m.body),"update-time":m.created_at,issue:m,"is-list":"",onUpdate:_=>L(h,_),onLike:_=>b(h,_)},null,8,["body","update-time","issue","onUpdate","onLike"])]))),256))]),_:1},8,["loading"]),r(o)?(c(),l("div",J,[i(y),C("疯狂加载中...")])):w("",!0),r(u)?(c(),l("div",O,"没有更多内容了")):w("",!0)])}}});export{ee as default};
