import{E as B,a as N}from"./DUVLY2ZI.js";import{A as S,_ as x}from"./DCT8RX0W.js";import"./BlO2dady.js";import{d as E,u as M,r as d,i as U,l as A,y as V,c as l,e as i,R as f,a as r,U as C,f as w,ad as H,o as c,b as I,M as j,ab as F}from"./Cmo66gyz.js";import{u as P}from"./D1xpk_q1.js";import"./Cu7rmUuZ.js";import"./Cu-y1uUv.js";import"./BLET7SRi.js";const T={class:"moment-wrapper",style:{width:"1086px"}},$={class:"article-item-wrapper"},q={class:"article-item-wrapper"},R={key:0,class:"list-loading"},Y={key:1,class:"list-loading"},Z=E({__name:"moment",setup(z){M({title:"随笔 - Leoon Liang - Blog",ogTitle:"随笔 - Leoon Liang - Blog"});const o=d([]),u=d(!1),a=d(!0),n=d({labels:"",per_page:30,page:1}),g=async()=>{const e=H();try{if(a.value||u.value)return;a.value=!0;const t={labels:n.value.labels,per_page:n.value.per_page.toString(),page:n.value.page.toString()},s=await $fetch("/api/moment",{params:t,headers:{...P(t),"x-fingerprint":e.$fingerprint.value}});if(s){const p=s;o.value=[...o.value,...p],p.length<n.value.per_page?u.value=!0:n.value.page=n.value.page+1}a.value=!1}catch{a.value=!1}},k=e=>(e=e.replace(/https:\/\/raw\.githubusercontent\.com\/LeoonLiang\/pic\/main\//g,"https://gcore.jsdelivr.net/gh/LeoonLiang/pic@main/"),e.replace(/\/\/(?:\w+\.)?jsdelivr\.net/g,"//cdn.tsinbei.com")),v=()=>{const e=window.scrollY+window.innerHeight,t=document.body.scrollHeight-100;e>=t&&g()},L=(e,t)=>{o.value.splice(e,1,t)},b=(e,t)=>{o.value[e].is_like=t,o.value[e].like_count=t?Number(o.value[e].like_count)+1:Number(o.value[e].like_count)-1};return U(()=>{u.value||window.addEventListener("scroll",v)}),A(()=>{window.removeEventListener("scroll",v)}),V(()=>{n.value.page=1,o.value=[],a.value=!1,g()}),(e,t)=>{const s=N,p=B,y=x;return c(),l("div",T,[i(p,{loading:r(a)&&r(o).length===0,animated:"",count:6,throttle:60},{template:f(()=>[I("div",$,[i(s,{variant:"h1",style:{width:"40%",display:"block"}}),i(s,{variant:"text",style:{width:"20%","margin-top":"0.5rem"}})])]),default:f(()=>[(c(!0),l(j,null,F(r(o),(m,h)=>(c(),l("div",q,[i(S,{body:k(m.body),"update-time":m.created_at,issue:m,"is-list":"",onUpdate:_=>L(h,_),onLike:_=>b(h,_)},null,8,["body","update-time","issue","onUpdate","onLike"])]))),256))]),_:1},8,["loading"]),r(a)?(c(),l("div",R,[i(y),C("疯狂加载中...")])):w("",!0),r(u)?(c(),l("div",Y,"没有更多内容了")):w("",!0)])}}});export{Z as default};
