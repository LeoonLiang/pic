import{E as B,a as S}from"./DwR1moK3.js";import{A as x,_ as E}from"./D_D6BCQL.js";import"./CiYk6qZ1.js";import{d as M,u as U,r as u,i as A,l as C,y as V,c as i,e as p,R as L,a as s,U as H,f as h,ad as I,o as r,b as $,M as j,ab as F}from"./VLVLyXKu.js";import{u as P}from"./D1xpk_q1.js";import"./R7xUUg5G.js";import"./CRJ3Y023.js";import"./CAORQgYJ.js";const R={class:"moment-wrapper",style:{width:"1086px"}},T={class:"article-item-wrapper"},q={class:"article-item-wrapper"},Y={key:0,class:"list-loading"},z={key:2,class:"list-loading"},ee=M({__name:"moment",setup(D){U({title:"随笔 - Leoon Liang - Blog",ogTitle:"随笔 - Leoon Liang - Blog"});const o=u([]),c=u(!1),a=u(!0),n=u({labels:"",per_page:30,page:1}),v=u(0),_=async(e=!1)=>{const t=I();try{if(a.value||c.value)return;a.value=!0;const l={labels:n.value.labels,per_page:n.value.per_page.toString(),page:n.value.page.toString()},d=await $fetch("/api/moment",{params:l,headers:{...P(l),"x-fingerprint":t.$fingerprint.value}});if(d){const m=d;o.value=[...o.value,...m],m.length<n.value.per_page?c.value=!0:n.value.page=n.value.page+1}e?v.value+=1:v.value=0,a.value=!1}catch{a.value=!1}},b=e=>(e=e.replace(/https:\/\/raw\.githubusercontent\.com\/LeoonLiang\/pic\/main\//g,"https://gcore.jsdelivr.net/gh/LeoonLiang/pic@main/"),e.replace(/\/\/(?:\w+\.)?jsdelivr\.net/g,"//cdn.tsinbei.com")),w=()=>{const e=window.scrollY+window.innerHeight,t=document.body.scrollHeight-100;e>=t&&v.value<2&&_(!0)},y=(e,t)=>{o.value.splice(e,1,t)},N=(e,t)=>{o.value[e].is_like=t,o.value[e].like_count=t?Number(o.value[e].like_count)+1:Number(o.value[e].like_count)-1};return A(()=>{c.value||window.addEventListener("scroll",w)}),C(()=>{window.removeEventListener("scroll",w)}),V(()=>{n.value.page=1,o.value=[],a.value=!1,_()}),(e,t)=>{const l=S,d=B,m=E;return r(),i("div",R,[p(d,{loading:s(a)&&s(o).length===0,animated:"",count:6,throttle:60},{template:L(()=>[$("div",T,[p(l,{variant:"h1",style:{width:"40%",display:"block"}}),p(l,{variant:"text",style:{width:"20%","margin-top":"0.5rem"}})])]),default:L(()=>[(r(!0),i(j,null,F(s(o),(g,k)=>(r(),i("div",q,[p(x,{body:b(g.body),"update-time":g.created_at,issue:g,"is-list":"",onUpdate:f=>y(k,f),onLike:f=>N(k,f)},null,8,["body","update-time","issue","onUpdate","onLike"])]))),256))]),_:1},8,["loading"]),s(a)?(r(),i("div",Y,[p(m),H("疯狂加载中...")])):h("",!0),!s(a)&&!s(c)?(r(),i("div",{key:1,class:"list-more",onClick:t[0]||(t[0]=g=>_(!1))},"点击加载更多")):h("",!0),s(c)?(r(),i("div",z,"没有更多内容了")):h("",!0)])}}});export{ee as default};
